# 正则抽取

![](https://img.shields.io/badge/python-3.7+-brightgreen)

## Requirements

- Python 3.7

## 测试

可以使用 `Docker` 运行测试。

1. 构建并运行容器

    ```bash
    make test
    ```

2. 进入容器

    ```bash
    docker exec -it regex_test_container /bin/bash
    ```
   
3. 测试

    ```bash
    python main.py
    ```
   
4. 停止并删除容器、镜像

    ```bash
    make clean
    ```

## 手机号码

### 编号规则依据

手机号码的编码规则，可以参考工信部 2017 年发布的 [《电信网编号计划》(2017 版)](http://miinac.gov.cn/components/Notice.action?doType=view&id=150951611150008830915)。

关于手机号码的正则抽取，本工具主要依据该电信网编号计划，对计划中的 E.164 类号码进行抽取。主要涉及两类号码:

- 固定网电话号码

    ```text
    结构: 国家码（86）+ 长途区号 + 本地用户号码
    说明: 国内有效号码最大位长为11位
    ```

- 移动网电话号码

    ```text
    结构: 国家码（86）+ 网号 + HLR识别号（H0H1H2H3）+ 用户号码（ABCD）
    说明: 
      - 公众移动网电话号码网号为3位，国内有效号码位长为11位
      - 物联网网号为5位，国内有效号码位长为13位
    ```

### 抽取规则说明

1. 号码抽取**支持**以下情况:

    - 符合规则的、以 `1` 开头的**国内公众移动通信网网号**；
    - 符合规则的**国内固定网电话号码**
    
        - `区号-用户号码`，如 `021-88792031`
        - `区号用户号码`，如 `02188792031`
        
    - 对包含号码模式的任意数字串进行区分，规定不能从中抽取号码。例如: `1392180193312345` 和 `1234513921801933
    ` 就不能抽取其中的号码；
    - 支持国家码格式，可以包含括号和空白字符。括号支持全角半角符号。
        
        - `(86)`
        - `（86）`
        - `(+86)`
        - `（+86）`
        - `+86`
        - `( +86 ）`

2. 号码抽取**暂不支持**以下情况:

    - 国内公众移动通信网号码中包含 `-` 符号，例如: `139-2180-1933`
    - 编号计划中 `92`、`98` 是**规划**用于公众移动通信网网号的号段，暂不抽取
    - 国内固定网电话号码中包含 `()` 符合，例如: `(021)-88792031`、`(021)88792031`

### 示例

```text
# 国内公众移动通信网网号
❎ hahah 11115021801933hahahhahhahah18919231909111
❎ 150218019331234567890
✅ hahah15021801933hahahhahhahah 18919231909
✅ (+86) 15021801933 haha
✅ (+86）15021801933haha
✅ +86 15021801933haha

# 国内固定网电话号码
❎ haha 11021-8879203haha0102201220211
❎ 11021-887920311
✅ haha 021-88792031haha01022012202
✅ (+86) 021-88792031 haha
✅ (+86）021-88792031
✅ +86 021-88792031
```

### TODO

目前匹配手机号时，对于待处理文件的每一块，直接打印出匹配的号码。后续是否需要将匹配的结果存储起来，待文件全部处理完成之后，再打印出所有的匹配结果，还需要再讨论。


## 地址

国内地址的数据来源有两个:

- [2019年中华人民共和国行政区划代码](http://www.mca.gov.cn/article/sj/xzqh/2019/)
- [Administrative-divisions-of-China](https://github.com/modood/Administrative-divisions-of-China), 是根据中华人民共和国行政区划代码开源的数据

### 抽取规则说明

1. 地址抽取**支持**以下格式的数据:

    - 文本中包含: `省级（省份、直辖市、自治区）`、`县级（区县）`、小区|村|路名、号数信息
    - 其他的例如: `地级（城市）`、`乡级（乡镇、街道）` 行政区划可以不包含

    ```text
    XX省XX市XX区(县|旗|新城)XX乡(镇|办事处)XX路(小区|村)XX号XX室(号楼|幢|楼|栋)
    XX省XX区(县|旗|新城)XX乡(镇|办事处)XX路(小区|村)XX号XX室(号楼|幢|楼|栋)
    XX省XX区(县|旗|新城)XX路(小区|村)XX号XX室(号楼|幢|楼|栋)
    XX省XX区(县|旗|新城)XX路(小区|村)XX号
    ```

2. 地址抽取**暂不支持**以下情况:

    - 未包含`村级（村委会、居委会）`行政区划
    - 小区|村|路名、号数等信息未做校验
    
### 示例

```text
✅ 湖南省桃源县枫树维吾尔族回族乡牛场村03038号
✅ 江西省南昌市青山湖区上海路382号12栋5单元601室
✅ 福建省清流县余朋乡东坑村文化街61号
✅ 上海市黄浦区复兴北路123号
❎ 上海市番禺区复兴北路123号
❎ 华容县
✅ 测试上海市黄浦区复兴北路123号测试
✅ 测试江西省青山湖区上海路382号12栋5单元601室测试
```
## 身份证号码
### 依据规则
[中华人民共和国国家标准](https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD%E5%9B%BD%E5%AE%B6%E6%A0%87%E5%87%86)[GB 11643-1999《公民身份号码》](https://zh.wikisource.org/wiki/GB_11643-1999_%E5%85%AC%E6%B0%91%E8%BA%AB%E4%BB%BD%E5%8F%B7%E7%A0%81)中规定：公民身份号码是特征组合码，由十七位数字本体码和一位校验码组成。

18位数字组合的方式是：

| 1 1 0 1 0	2 | Y Y	Y Y	M M D D | 8 8 | 8 | X |
| :---------: | :---------------: | :----: | :--: | :----: |
|    区域码(6位)    |  出生日期码(8位)     | 顺序码(2位) | 性别码(1位) | 校验码(1位) |


- **区域码** 指的是公民常住户口所在县（市、镇、区）的[行政区划代码](https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD%E8%A1%8C%E6%94%BF%E5%8C%BA%E5%88%92%E4%BB%A3%E7%A0%81)，如110102是北京市-西城区。但港澳台地区居民的身份号码只精确到省级。
- **出生日期码** 表示公民出生的公历年（4位）、月（2位）、日（2位）。
- **顺序码** 表示在同一区域码所标识的区域范围内，对同年、同月、同日出生的人编定的顺序号。
- **性别码** 奇数表示男性，偶数表示女性。
- 最后一位是**校验码**，这里采用的是**ISO 7064:1983,MOD 11-2**校验码系统。校验码为一位数，但如果最后采用校验码系统计算的校验码是“10”，碍于身份证号码为18位的规定，则以“X”代替校验码“10”。

### 校验码计算方法
-  **1.** 将身份证号码从右至左标记为![](https://wikimedia.org/api/rest_v1/media/math/render/svg/779a0c3f011a79efb854f48c9a7398cc17b04305)，最后一位即为校验码；
-  **2.** 计算权重系数 ![](https://wikimedia.org/api/rest_v1/media/math/render/svg/5f817855c5ad3b88b412e60f83f2201fd386ea2a)

所以

|**i**|18|17|16|15|14|13|12|11|10|9|8|7|6|5|4|3|2|1|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:| :-:| :-:|
| **W<sub>i</sub>** |7|9|10|5|8|4|2|1|6|3|7|9|10|5|8|4|2|1|

- **3.**  计算![](https://wikimedia.org/api/rest_v1/media/math/render/svg/dad8e73b5a78c0c3d0ca9097d64adad4daacbf31)


### 步骤

- 1. 首先按照标准正则匹配18位数字，在此处满足年，月，日等规则
- 2. 校验码是否正确
- 3. 校验住址，校验年份：可配置，查取年龄最大的中国老人是1887，年龄最小的小于2020
- 4. 分析出一些信息，与地址，性别，年龄，生日，星座等便于以后分析


### 亮点：
- 1.为了校验方便，按照规则生成一些身份证号码，便于检测。
- 2.当句子中含有多个身份证号码时，可以识别出全部的满足条件的身份证号
- 3.当有连续超过18位数字，虽然可以从中找出身份证，但这种情况，我们认为是不合理的身份证号。
- 4.身份证号用颜色展示出来

### TODO:
- 1.校验时：没有考虑闰年的29号
- 2.校验时，地址在变，要实施更新，地址可能还有遗漏的
- 3.存在15位身份证号码
正则公式：ID_NUMBER_15_REGEX = r"((?<!\d)[1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}(?!\d))"
在这里不做考虑

### 示例

```text
# 身份证号
✅370829198009172818
✅是他啊11010419650811242X一刻也不能分割23040519790919984X
❎11370829198009172818122