# 正则抽取

![](https://img.shields.io/badge/python-3.7+-brightgreen)

## Requirements

- Python 3.7

## 测试

可以使用 `Docker` 运行测试。

1. 构建并运行容器

    ```bash
    make test
    ```

2. 进入容器

    ```bash
    docker exec -it regex_test_container /bin/bash
    ```
   
3. 测试

    ```bash
    python main.py
    ```
   
4. 停止并删除容器、镜像

    ```bash
    make clean
    ```

## 手机号码

### 编号规则依据

手机号码的编码规则，可以参考工信部 2017 年发布的 [《电信网编号计划》(2017 版)](http://miinac.gov.cn/components/Notice.action?doType=view&id=150951611150008830915)。

关于手机号码的正则抽取，本工具主要依据该电信网编号计划，对计划中的 E.164 类号码进行抽取。主要涉及两类号码:

- 固定网电话号码

    ```text
    结构: 国家码（86）+ 长途区号 + 本地用户号码
    说明: 国内有效号码最大位长为11位
    ```

- 移动网电话号码

    ```text
    结构: 国家码（86）+ 网号 + HLR识别号（H0H1H2H3）+ 用户号码（ABCD）
    说明: 
      - 公众移动网电话号码网号为3位，国内有效号码位长为11位
      - 物联网网号为5位，国内有效号码位长为13位
    ```

### 抽取规则说明

1. 号码抽取**支持**以下情况:

    - 符合规则的、以 `1` 开头的**国内公众移动通信网网号**；
    - 符合规则的**国内固定网电话号码**
    
        - `区号-用户号码`，如 `021-88792031`
        - `区号用户号码`，如 `02188792031`
        
    - 对包含号码模式的任意数字串进行区分，规定不能从中抽取号码。例如: `1392180193312345` 和 `1234513921801933
    ` 就不能抽取其中的号码；
    - 支持国家码格式，可以包含括号和空白字符。括号支持全角半角符号。
        
        - `(86)`
        - `（86）`
        - `(+86)`
        - `（+86）`
        - `+86`
        - `( +86 ）`

2. 号码抽取**暂不支持**以下情况:

    - 国内公众移动通信网号码中包含 `-` 符号，例如: `139-2180-1933`
    - 编号计划中 `92`、`98` 是**规划**用于公众移动通信网网号的号段，暂不抽取
    - 国内固定网电话号码中包含 `()` 符合，例如: `(021)-88792031`、`(021)88792031`

### 示例

```text
# 国内公众移动通信网网号
❎ hahah 11115021801933hahahhahhahah18919231909111
❎ 150218019331234567890
✅ hahah15021801933hahahhahhahah 18919231909
✅ (+86) 15021801933 haha
✅ (+86）15021801933haha
✅ +86 15021801933haha

# 国内固定网电话号码
❎ haha 11021-8879203haha0102201220211
❎ 11021-887920311
✅ haha 021-88792031haha01022012202
✅ (+86) 021-88792031 haha
✅ (+86）021-88792031
✅ +86 021-88792031
```

### TODO

目前匹配手机号时，对于待处理文件的每一块，直接打印出匹配的号码。后续是否需要将匹配的结果存储起来，待文件全部处理完成之后，再打印出所有的匹配结果，还需要再讨论。


## 地址

国内地址的数据来源有两个:

- [2019年中华人民共和国行政区划代码](http://www.mca.gov.cn/article/sj/xzqh/2019/)
- [Administrative-divisions-of-China](https://github.com/modood/Administrative-divisions-of-China), 是根据中华人民共和国行政区划代码开源的数据

### 抽取规则说明

1. 地址抽取**支持**以下格式的数据:

    - 文本中包含: `省级（省份、直辖市、自治区）`、`县级（区县）`、小区|村|路名、号数信息
    - 其他的例如: `地级（城市）`、`乡级（乡镇、街道）` 行政区划可以不包含

    ```text
    XX省XX市XX区(县|旗|新城)XX乡(镇|办事处)XX路(小区|村)XX号XX室(号楼|幢|楼|栋)
    XX省XX区(县|旗|新城)XX乡(镇|办事处)XX路(小区|村)XX号XX室(号楼|幢|楼|栋)
    XX省XX区(县|旗|新城)XX路(小区|村)XX号XX室(号楼|幢|楼|栋)
    XX省XX区(县|旗|新城)XX路(小区|村)XX号
    ```

2. 地址抽取**暂不支持**以下情况:

    - 未包含`村级（村委会、居委会）`行政区划
    - 小区|村|路名、号数等信息未做校验
    
### 示例

```text
✅ 湖南省桃源县枫树维吾尔族回族乡牛场村03038号
✅ 江西省南昌市青山湖区上海路382号12栋5单元601室
✅ 福建省清流县余朋乡东坑村文化街61号
✅ 上海市黄浦区复兴北路123号
❎ 上海市番禺区复兴北路123号
❎ 华容县
✅ 测试上海市黄浦区复兴北路123号测试
✅ 测试江西省青山湖区上海路382号12栋5单元601室测试
```

## 身份证号

**支持:**
- 国内 18 位身份证号
- 最大出生年份: `1887`, 最小出生年份: `2019`
- 支持解析: 出生地、生日、年龄、星座、性别等信息
